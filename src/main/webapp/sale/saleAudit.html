<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>销售订单审核</title>
    <link rel="stylesheet" type="text/css"
          href="/static/jquery-easyui-1.3.3/themes/bootstrap/easyui.css"></link>
    <link rel="stylesheet" type="text/css"
          href="/static/jquery-easyui-1.3.3/themes/icon.css"></link>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/static/js/date.js"></script>
    <script type="text/javascript" src="/js/main.js"></script>
    <script type="text/javascript">
        var url;

        function formatUser(val, row) {
            return val.trueName + "&nbsp;(" + val.userName + ")&nbsp;";
        }

        function searchSale() {
            var clientId;
            var clerkId;
            if (isNaN($("#s_client").combobox("getValue"))) {
                clientId = "";
            } else {
                clientId = $("#s_client").combobox("getValue");
            }

            if (isNaN($("#s_clerk").combobox("getValue"))) {
                clerkId = "";
            } else {
                clerkId = $("#s_clerk").combobox("getValue");
            }
            $("#dg").datagrid({
                url: '/admin/saleList/list',
                queryParams: {
                    saleNumber: $("#s_saleNumber").val(),
                    clientId: clientId,
                    clerkId: clerkId,
                    bSaleDate: $("#s_bSaleDate").datebox("getValue"),
                    eSaleDate: $("#s_eSaleDate").datebox("getValue")
                }
            });
        }

        function formatSupplier(val, row) {
            return val.name;
        }

        //格式化日期
        Date.prototype.format = function (formatStr) {
            var str = formatStr;
            var Week = ['日', '一', '二', '三', '四', '五', '六'];
            str = str.replace(/yyyy|YYYY/, this.getFullYear());
            str = str.replace(/MM/,
                (this.getMonth() + 1) > 9 ? (this.getMonth() + 1).toString()
                    : '0' + (this.getMonth() + 1));
            str = str.replace(/dd|DD/, this.getDate() > 9 ? this.getDate()
                .toString() : '0' + this.getDate());
            return str;
        }

        //显示时间数据时先进行格式化
        function formatDate(val, row) {
            var dateType = "";
            var date = new Date();
            date.setTime(val);
            dateType = date.format("yyyy-MM-dd")
            return dateType;
        }

        //字符串转日期
        function strToDate(val) {
            var dateType = "";
            var date = new Date(val).getTime();
            return date;
        }

        function strDate(val) {
            var dateType = "";
            var date = new Date(val).format("yyyy-MM-dd");
            return date;
        }


        function formatUser(val, row) {
            return val.trueName + "&nbsp;(" + val.userName + ")&nbsp;";
        }

        $(document)
            .ready(
                function () {
                    $('#dg2').datagrid({
                        rowStyler: function (index, row) {
                            if (row.level != 0) {
                                return 'background-color:orange;color:blue;font-weight:bold;';
                            }
                        }
                    });

                    $("#dg").datagrid(
                        {
                            onDblClickRow: function (index, row) {
                                $("#dialog").dialog("open").dialog(
                                    "setTitle", "修改信息");
                                $("#saleNumber").val(row.saleNumber);
                                $("#saleDate").datebox("setValue", strDate(row.saleDate));
                                if (row.client) {
                                    $.ajax({
                                        type: "POST",
                                        url: "/admin/client/findByName?name=" + row.client.name,
                                        success: function (result) {
                                            $("#client").combobox("setValue", result.id);
                                        }
                                    });
                                }
                                if (row.clerk) {
                                    $.ajax({
                                        type: "POST",
                                        url: "/admin/clerk/findByName?clerk=" + row.clerk.name,
                                        success: function (result) {
                                            $("#clerk").combobox("setValue", result.id);
                                        }
                                    });
                                }
                                ;
                                $("#lankman").val(row.lankman);
                                $("#address").val(row.address);
                                $("#tel").val(row.tel);
                                $("#deliveryDate").datebox("setValue", strDate(row.deliveryDate));//发货时间
                                $("remark").val(row.remark);
                                url = "/admin/saleList/saveTwo?id="
                                    + row.id;
                            }
                        });

                    $("#dlg").dialog("close");
                    $("#s_bSaleDate").datebox("setValue",
                        genLastMonthDayStr()); // 设置上个月日期
                    $("#s_eSaleDate").datebox("setValue", genTodayStr()); // 设置当前日期

                    $("#dg")
                        .datagrid(
                            {
                                // url: "/admin/saleList/list",
                                columns: [[
                                    {
                                        field: "id",
                                        width: "20",
                                        align: "center",
                                        title: "销售单ID",
                                        formatter: function (
                                            val, row) {
                                            saleListId = val;
                                            return val;
                                        },
                                    },
                                    {
                                        field: "saleNumber",
                                        width: "150",
                                        align: "center",
                                        title: "销售单号"
                                    },
                                    {
                                        field: "saleDate",
                                        width: "100",
                                        align: "center",
                                        formatter: function (val, row) {
                                            if (row.saleNumber) {
                                                var data = row.saleNumber;
                                                console.log(data);
                                                // console.log(data.substring(2,6) + "-" + data.substring(6,8) + "-" + data.substring(8,10));
                                                return data.substring(2, 6) + "-" + data.substring(6, 8) + "-" + data.substring(8, 10);
                                            }
                                            return "";
                                        },
                                        title: "销售日期"
                                    },
                                    {
                                        field: "client",
                                        width: "100",
                                        align: "center",
                                        formatter: function (
                                            val, row) {
                                            if (row.client) {
                                                return val.name;
                                            }
                                            return "";
                                        },
                                        title: "客户"
                                    },
                                    {
                                        field: "dingjin",
                                        width: "100",
                                        align: "center",
                                        title: "订金"
                                    },
                                    {
                                        field: "totalPrice",
                                        width: "100",
                                        align: "center",
                                        title: "总价格"
                                    },
                                    {
                                        field: "tel",
                                        width: "100",
                                        align: "center",
                                        title: "客户电话"
                                    },
                                    {
                                        field: "address",
                                        width: "200",
                                        align: "center",
                                        title: "客户地址"
                                    },
                                    {
                                        field: "deliveryDate",
                                        width: "100",
                                        align: "center",
                                        formatter: function (
                                            val, row) {
                                            if (val) {
                                                var dateType = "";
                                                var date = new Date();
                                                date
                                                    .setTime(val);
                                                dateType = date
                                                    .format("yyyy-MM-dd")
                                                return dateType;
                                            }
                                            return;
                                        },
                                        title: "发货时间"
                                    }, {
                                        field: "remark",
                                        width: "100",
                                        align: "center",
                                        title: "备注"
                                    }

                                ]],
                                onSelect: function (index, row) {
                                    $("#cc1").combobox("reset");
                                    $("#dg2")
                                        .datagrid(
                                            {
                                                url: '/admin/saleList/listProduct',
                                                queryParams: {
                                                    saleListId: row.id
                                                },
                                                columns: [[
                                                    {
                                                        field: 'cb',
                                                        checkbox: "true",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: 'state',
                                                        title: "订单状态",
                                                        width: "150",
                                                        align: "center",
                                                        formatter: function (
                                                            value,
                                                            row,
                                                            index) {
                                                            if (row.state == "下单") {
                                                                $(
                                                                    "#state")
                                                                    .css(
                                                                        "color",
                                                                        "#FF0000");
                                                                return '<span style="color:#0000FF">'
                                                                    + '未审核'
                                                                    + '</span>';
                                                            } else if (row.state
                                                                .indexOf("审核失败") == 0) {
                                                                return '<span style="color:#FF0000">'
                                                                    + row.state
                                                                    + '</span>';
                                                            } else if (row.state == "审核通过") {
                                                                return '<span style="color:#0B610B">'
                                                                    + row.state
                                                                    + '</span>';
                                                            } else {
                                                                return '<span style="color:#8A0829">'
                                                                    + row.state
                                                                    + '</span>';
                                                            }
                                                        }
                                                    },
                                                    {
                                                        field: 'code',
                                                        title: "序号",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: 'informNumber',
                                                        title: "通知单号",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: 'name',
                                                        title: "产品名称",
                                                        width: "200",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "clientname",
                                                        title: "客户名称",
                                                        width: "100",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "peasant",
                                                        title: "农户名称",
                                                        width: "100",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "model",
                                                        title: "幅宽（m）",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "price",
                                                        title: "厚度（mm）",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "length",
                                                        title: "长度（m）",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "hebingLength",
                                                        title: "合并长度",
                                                        width: "100",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "meter",
                                                        title: "实际厚度",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "color",
                                                        title: "颜色",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "oneweight",
                                                        title: "单件重量（kg）",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "num",
                                                        title: "订货数量",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "sumwight",
                                                        title: "总重量（kg）",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "accomplishNumber",
                                                        title: "完成数量",
                                                        width: "50",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "dao",
                                                        title: "剖刀",
                                                        width: "100",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "letter",
                                                        title: "印字",
                                                        width: "200",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "demand",
                                                        title: "要求",
                                                        width: "250",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "realityweight",
                                                        title: "实际重量（kg）",
                                                        width: "100",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "unitPrice",
                                                        title: "单价",
                                                        width: "100",
                                                        align: "center"
                                                    },
                                                    {
                                                        field: "totalPrice",
                                                        title: "金额",
                                                        width: "100",
                                                        align: "center"
                                                    }
                                                    ]]
                                            });
                                }
                            });

                });

        function formatPrice(val, row) {
            return "¥" + val;
        }

        function formatTotal(val, row) {
            return "¥" + val;
        }

        var ids;

        //审核
        function auditResult(value) {
            var selectedRows = $("#dg2").datagrid("getSelections");
            if (selectedRows.length == 0) {
                $.messager.alert("系统提示", "请选择要审核的信息！");
                return;
            }
            var strIds = [];
            for (var i = 0; i < selectedRows.length; i++) {
                strIds.push(selectedRows[i].id);
            }
            ids = strIds.join(",");
            //审核成功
            if (value == 1) {
                $.messager
                    .confirm(
                        "系统提示",
                        "您确定审核这些数据吗？",
                        function (r) {
                            if (r) {
                                $
                                    .post(
                                        "/admin/saleListProduct/passTheAudit",
                                        {
                                            ids: ids
                                        },
                                        function (result) {
                                            if (result.success) {
                                                $.messager.alert(
                                                    "系统提示",
                                                    "审核已通过!");
                                                $
                                                    .post(
                                                        "/admin/saleListProduct/listAllBySaleList",
                                                        {
                                                            id: $("#dg").datagrid("getSelections")[0].id
                                                        },
                                                        function (
                                                            data) {
                                                            if (data.success) {

                                                            }
                                                        });
                                                $("#dg")
                                                    .datagrid(
                                                        "selectRecord",
                                                        $(
                                                            "#dg")
                                                            .datagrid(
                                                                "getSelections")[0].id);
                                                console
                                                    .log($(
                                                        "#dg")
                                                        .datagrid(
                                                            "getSelections")[0].id);
                                                $("#dg2").datagrid(
                                                    "reload");
                                            } else {
                                                $.messager
                                                    .alert(
                                                        "系统提示",
                                                        result.errorInfo);
                                            }
                                        });

                            }
                        });
            } else if (value == 0) {//审核失败
                $("#dlg").dialog("open");
            }
        }

        //提交审核未通过原因
        function saveCause() {
            var cause = "审核失败：" + $("#cause").val();
            $.post("/admin/saleListProduct/auditFailure", {
                ids: ids,
                cause: cause
            }, function (result) {
                if (result.success) {
                    $.messager.alert("系统提示", "审核结果已提交");
                    $("#dg2").datagrid("reload");
                } else {
                    $.messager.alert("系统提示", result.errorInfo);
                }
            });
            closeCause();
        }

        //关闭审核未通过原因面板
        function closeCause() {
            $("#dlg").dialog("close");
            $("#dialog").dialog("close");
        }

        //根据审核条件进行订单商品信息的查询
        function auditQuery(value) {
            var selectenRows = $("#dg").datagrid("getSelections");
            if (selectenRows.length != 1) {
                $.messager
                    .confirm(
                        "系统提示",
                        "<span style='color: red;'>请选择一条销售信息</span>");
                return;
            } else {
                if (value == "未审核") {
                    value = "下单";
                }
                $("#dg2")
                    .datagrid(
                        {
                            url: '/admin/saleList/listProductByState',
                            queryParams: {
                                id: selectenRows[0].id,
                                state: value
                            },
                            columns: [[
                                {
                                    field: 'cb',
                                    checkbox: "true",
                                    align: "center"
                                },
                                {
                                    field: 'state',
                                    title: "订单状态",
                                    width: "150",
                                    align: "center",
                                    formatter: function (value, row,
                                                         index) {
                                        if (row.state == "下单") {
                                            $("#state").css("color",
                                                "#FF0000");
                                            return '<span style="color:#0000FF">'
                                                + '未审核' + '</span>';
                                        } else if (row.state
                                            .indexOf("审核失败") == 0) {
                                            return '<span style="color:#FF0000">'
                                                + row.state
                                                + '</span>';
                                        } else if (row.state == "审核通过") {
                                            return '<span style="color:#0B610B">'
                                                + row.state
                                                + '</span>';
                                        } else {
                                            return '<span style="color:#8A0829">'
                                                + row.state
                                                + '</span>';
                                        }
                                    }
                                }, {
                                    field: 'name',
                                    title: "产品名称",
                                    width: "200",
                                    align: "center"
                                }, {
                                    field: "model",
                                    title: "幅宽（m）",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "price",
                                    title: "厚度（mm）",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "length",
                                    title: "长度（m）",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "color",
                                    title: "颜色",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "oneweight",
                                    title: "单件重量（kg）",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "num",
                                    title: "订货数量",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "sumwight",
                                    title: "总重量（kg）",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "realityweight",
                                    title: "实际重量（kg）",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "accomplishNumber",
                                    title: "完成数",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "clientname",
                                    title: "客户名称",
                                    width: "100",
                                    align: "center"
                                }, {
                                    field: "peasant",
                                    title: "农户名称",
                                    width: "50",
                                    align: "center"
                                }, {
                                    field: "saleListId",
                                    title: "ID",
                                    width: "100",
                                    align: "center",
                                    formatter: function (val, row) {
                                        return "";
                                    }
                                }]]
                        });
            }
        }

        function baocun() {
            $.post(url, {
                saleNumber: $("#saleNumber").val(),
                saleDateq: $("#saleDate").datebox("getValue"),
                client: $("#client").combobox("getValue"),
                clerk: $("#clerk").combobox("getValue"),
                lankman: $("#lankman").val(),
                tel: $("#tel").val(),
                address: $("#address").val(),
                deliveryDateq: $("#deliveryDate").datebox("getValue"),
                remark: $("#remark").val()
            }, function (result) {
                if (result.success) {
                    $.messager.alert("系统提示", "保存成功！");
                    resetValue();
                    $("#dialog").dialog("close");
                    $("#dg").datagrid("reload");
                } else {
                    $.messager.alert("系统提示", result.errorInfo);
                }
            });
        }

        function openRoleModifyDialog() {
            var selectedRows = $("#dg").datagrid("getSelections");
            if (selectedRows.length != 1) {
                $.messager.alert("系统提示", "请选择一条要修改的数据！");
                return;
            }
            var row = selectedRows[0];
            $("#dialog").dialog("open").dialog("setTitle", "修改信息");
            $("#saleNumber").val(row.saleNumber);
            $("#saleDate").datebox("setValue", strDate(row.saleDate));
            $("#client").combobox("setValue", row.client.name);
            $("#clerk").combobox("setValue", row.clerk.name);
            $("#lankman").val(row.lankman);
            $("#address").val(row.address);
            $("#tel").val(row.tel);
            $("#deliveryDate").datebox("setValue", strDate(row.deliveryDate));//发货时间
            $("remark").val(row.remark);
            url = "/admin/saleList/saveTwo?id="
                + row.id;
        }

        function resetValue() {
            $("#client").combobox('reset');
            $("#clerk").combobox('reset');
            $("#saleDate").datebox('reset');
            $("#deliveryDate").datebox('reset');
            $("#saleNumber").val("");
            $("#lankman").val("");
            $("#tel").val("");
            $("#address").val("");
            $("#remark").val("");

        }

        var a;

        //修改saleListProduct
        function editSaleListProduct() {
            var row = $("#dg2").datagrid("getSelections");
            if (row.length != 1) {
                $.messager.alert("系统提示", "<span style='color: red;'>请选择一行要修改的数据！！</span>");
                return;
            }
            var rows = row[0];
            // console.log(rows);
            a = rows.accomplishNumber == null ? 0 : rows.accomplishNumber;
            if (rows.state == "提货" || rows.state == "装车") {
                $.messager.alert("系统提示", "<span style='color: red;'>产品已生产完成！不可修改！！</span>");
            } else {
                if (rows.state == "审核通过" || rows.state == "下单") {
                    rows.jiTai = null;
                    rows.informNumber = null;
                } else if (rows.state.startsWith("生产完成")) {
                    rows.state = "下发机台：" + row[0].jiTai.name;
                    rows.jiTai = row[0].jiTai.id;
                }
                $("#dlg2").dialog("open").dialog("setTitle", "修改商标信息");
                $("#saleList").val(rows.saleList);
                rows.saleList = row[0].saleList.id;

                $("#fm2").form("load", rows);
            }
        }

        function change() {
            $.post("/admin//", {
                id: row[0].id,
                state: "下发机台：",
            }, function (result) {
                if (result.success) {
                    $("#dg").datagrid("reload");
                }
            });
        }

        //关闭dig2
        function closeGoodsDialog() {
            $("#dlg2").dialog("close");
        }

        //删除选中的订单商品
        function deleteSaleListProduct() {
            if ($("#dg2").datagrid('getSelections').length < 1) {
                $.messager.alert("系统提示", "<span style='color: red'>请选择一条要删除的信息</span>");
                return;
            }
            $.messager.confirm("系统提示", "<span style='color: red;'>确定要删除选中的信息吗</span>？", function (r) {
                if (r) {
                    var rows = $("#dg2").datagrid('getSelections');
                    var ids = [];
                    for (var i = 0; i < rows.length; i++) {
                        ids.push(rows[i].id);
                    }
                    var idArr = ids.join(",");
                    $.messager.progress({
                        title: "删除商品信息",
                        msg: "数据处理中，请稍后..."
                    });
                    $.ajax({
                        url: "/admin/saleListProduct/deleteByIdArr",
                        data: {idArr: idArr},
                        success: function (result) {
                            if (result.success) {
                                $.messager.progress("close");
                                $.messager.alert("系统提示", "<span style='color: red;'>删除成功！</span>")
                                location.reload();
                            } else {
                                $.messager.progress("close");
                                alert(result.msg);
                            }
                        }
                    });
                }
            })
        }

        //删除选中的订单信息
        function deleteSaleList() {
            if ($("#dg").datagrid('getSelected') == null) {
                alert("请选择一条要删除的信息");
                return;
            }
            $.messager.confirm("系统提示", "<span style='color: red;'>确定要删除选中的订单信息吗？</span>", function (r) {
                if (r) {
                    var id = $("#dg").datagrid('getSelected').id;
                    $.ajax({
                        url: "/admin/saleList/delete?id=" + id,
                        success: function () {
                            $("#dg").datagrid('reload');
                        }
                    });
                }
            });
        }

        //保存修改
        //封装订单信息传递后台
        function saveGoods() {
            var data = getFrom('#fm');
            console.log(data);
            data.id = $("#dg").datagrid("getSelected").id;
            $.ajax({
                type: "POST",
                url: "/admin/saleList/add",
                data: data,
                success: function (result) {
                    if (result.success) {
                        closeDlg("#dialog");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                        alert("添加成功！");
                    }
                }
            });
        }

        //修改数量
        function updateshuliang() {
            var rows = $("#dg2").datagrid("getSelections");
            if (!$("#shuliang").val()) {
                alert("请输入数量！");
                return;
            }
            if (rows.length != 1) {
                alert("请选择一条要修改的数据");
                return;
            }
            var row = rows[0];
            $.ajax({
                url: "/admin/saleListProduct/updateNum?num=" + $("#shuliang").val() + "&id=" + row.id,
                success: function (result) {
                    if (result) {
                        alert(result);
                        $("#dg2").datagrid("reload");
                        return;
                    }
                    ;
                    alert("未知错误！");
                    return;
                }
            });
        }

        //修改完成数
        function updateWanCheng() {
            var rows = $("#dg2").datagrid("getSelections");
            if (!$("#wancheng").val()) {
                alert("请输入数量！");
                return;
            }
            if (rows.length != 1) {
                alert("请选择一条要修改的数据");
                return;
            }
            var row = rows[0];
            console.log($("#shuliang").val());
            $.ajax({
                url: "/admin/saleListProduct/updateWanCehng?wancheng=" + $("#wancheng").val() + "&id=" + row.id,
                success: function (result) {
                    if (result) {
                        alert(result);
                        $("#dg2").datagrid("reload");
                        return;
                    }
                    ;
                    alert("未知错误！");
                    return;
                }
            });
        }

        function updatajitai() {
            var ids = [];
            var rows = $("#dg2").datagrid("getSelections");
            if (rows.length < 1) {
                alert("请选择要修改的数据！！");
                return;
            }
            if (!$("#updatejitai").combobox("getValue")) {
                alert("请选择机台！！");
                return;
            }
            for (var i = 0; i < rows.length; i++) {
                ids.push(rows[i].id);
            }
            var idarr = ids.join(",");
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/UpdateJiTai",
                data: {idarr: idarr, jitai: $("#updatejitai").combobox("getValue")},
                success: function (result) {
                    alert(result);
                    $("#dg2").datagrid("reload");
                }
            });
        }

        //修改产品名称
        function updataname() {
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#chanpingming").combobox("getValue")) {
                alert("请选择产品名称！");
                return;
            }
            var name = $("#chanpingming").combobox("getValue");
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updateName",
                data: {ids: ids, name: name},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#chanpingming").combobox("reset");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })

        }

        //修改长度
        function updatelength() {
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#changdu").val()) {
                alert("请输入长度！");
                return;
            }
            var length = $("#changdu").val();
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updatLength",
                data: {ids: ids, length: length},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#changdu").val("");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })

        }

        //修改幅宽
        function updatemodel() {
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#fukuan").val()) {
                alert("请输入幅宽！");
                return;
            }
            var model = $("#fukuan").val();
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updatModel",
                data: {ids: ids, model: model},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#fukuan").val("");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })

        }

        //修改厚度
        function updateprice() {
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#houdu").val()) {
                alert("请输入厚度！");
                return;
            }
            var price = $("#houdu").val();
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updatPrice",
                data: {ids: ids, price: price},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#houdu").val("");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })

        }

        //修改实际厚度
        function updatemeter() {
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#shijihoudu").val()) {
                alert("请输入实际厚度！");
                return;
            }
            var meter = $("#shijihoudu").val();
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updatMeter",
                data: {ids: ids, meter: meter},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#shijihoudu").val("");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })

        }

        //修改重量
        function updateOneweight() {
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#zhongliang").val()) {
                alert("请输入重量！");
                return;
            }
            var oneweight = $("#zhongliang").val();
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updatOneweight",
                data: {ids: ids, oneweight: oneweight},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#oneweight").val("");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })

        }

        //修改农户名
        function updatepeasant() {
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#nonghu").val()) {
                alert("请输入农户名！");
                return;
            }
            var peasant = $("#nonghu").val();
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updatPeasant",
                data: {ids: ids, peasant: peasant},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#nonghu").val("");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })

        }

        //修改颜色
        function updatecolor() {
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#yanse").val()) {
                alert("请输入农户名！");
                return;
            }
            var color = $("#yanse").val();
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updatColor",
                data: {ids: ids, color: color},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#yanse").val("");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })

        }

        //修改通知单号
        function updateInfo(){
            var ids = getDgId("#dg2");
            console.log(ids);
            if (!ids) {
                return;
            }
            if (!$("#info").val()) {
                alert("请输入单号！");
                return;
            }

            var info = $("#info").val();
            $.ajax({
                type: "POST",
                url: "/admin/saleListProduct/updatInfo",
                data: {ids: ids, info: info},
                success: function (result) {
                    if (result.success) {
                        alert("修改成功！");
                        $("#yanse").val("");
                        $("#dg").datagrid("selectRow", $("#dg").datagrid("getRowIndex", $("#dg").datagrid("getSelected")));
                    }
                }
            })
        }

    </script>
</head>
<body class="easyui-layout" style="margin: 1px">
<div region="north" style="height: 300px">
    <table id="dg" title="销售单据查询" class="easyui-datagrid"
           fitColumns="false" rownumbers="true" singleSelect="true" fit="true"
           toolbar="#tb" split="true">
        <thead>
        <th field="id" width="20" align="center">销售单号</th>
        <th field="saleNumber" width="150" align="center">销售单号</th>
        <th field="saleDate" width="100" align="center"
            formatter="formatDate">销售日期
        </th>
        <th field="client" width="100" align="center"
            formatter="formatSupplier">客户
        </th>
        <th field="clerk" width="100" align="center"
            formatter="formatSupplier">订金
        </th>
        <th field="user" width="150" align="center" formatter="formatUser">操作员</th>
        <th field="lankman" width="100" align="center">联系人</th>
        <th field="tel" width="100" align="center">客户电话</th>
        <th field="address" width="200" align="center">客户地址</th>
        <th field="deliveryDate" width="100" align="center"
            formatter="formatDate">发货时间
        </th>
        <th field="remark" width="100" align="center">备注</th>
        </thead>
    </table>

    <!-- dg顶部工具栏 -->
    <div id="tb">
        <fieldset style="border-color: #E7F0FF">
            <legend>查询设置</legend>
            &nbsp;单据号&nbsp; <input type="text" id="s_saleNumber" size="15"
                                   onkeydown="if(event.keyCode==13) searchSale()"/>
            &nbsp;&nbsp;&nbsp;客户：&nbsp;<input class="easyui-combobox"
                                              id="s_client" name="client.id" style="width: 100px"
                                              data-options="panelHeight:'auto',valueField:'id',textField:'name',url:'/admin/client/clientList'"/>
            &nbsp;&nbsp;&nbsp;业务员：&nbsp;<input class="easyui-combobox"
                                               id="s_clerk" name="clerk.id" style="width: 100px"
                                               data-options="panelHeight:'auto',valueField:'id',textField:'name',url:'/admin/clerk/clerkList'"/>
            &nbsp;&nbsp;&nbsp;日期：&nbsp; <input id="s_bSaleDate"
                                               class="easyui-datebox" editable=false style="width: 100px"/>
            &nbsp;&nbsp;&nbsp;&nbsp; <input id="s_eSaleDate"
                                            class="easyui-datebox" editable=false style="width: 100px"/>
            &nbsp;&nbsp;<a href="javascript:searchSale()"
                           class="easyui-linkbutton" iconCls="icon-search" plain="true">搜索</a>
            &nbsp;&nbsp;<a href="javascript:openRoleModifyDialog()"
                           class="easyui-linkbutton" iconCls="icon-edit" plain="true">修改</a>
            &nbsp;&nbsp;<a href="javascript:deleteSaleList()"
                           class="easyui-linkbutton" iconCls="icon-remove" plain="true">删除</a><br>
            &nbsp;&nbsp;&nbsp;订金：<input type="text" id="dingjin" style="width: 100px;">
            &nbsp;&nbsp;<a href="javascript:updatedingjin()" class="easyui-linkbutton" plain="true">确定</a>
        </fieldset>
    </div>
</div>

<div region="center" style="margin-top: 5px">
    <table id="dg2" class="easyui-datagrid" fitColumns="false"
           rownumbers="true" fit="true" split="true" toolbar="#tb2">
    </table>
</div>

<div id="tb2">
    <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:auditResult(1)"
                                         class="easyui-linkbutton" iconCls="icon-ok" plain="true">审核通过</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:auditResult(0)"
                                         class="easyui-linkbutton" iconCls="icon-no" plain="true">审核失败</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:deleteSaleListProduct()" class="easyui-linkbutton"
                                         iconCls="icon-remove"
                                         plain="true">删除本条数据</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a
            href="javascript:{if (!$('#dg').datagrid('getSelected')){alert('请选择一个订单！');}else {openDlg('#dialog');}}"
            class="easyui-linkbutton" iconCls="icon-remove"
            plain="true">添加一条数据</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;订单状态：&nbsp;
        <!-- <input id="combo" class="easyui-combobox" style="width:120px;" /> -->
        <!-- <input id="cc" name="dept" /> -->
        <input id="cc1" class="easyui-combobox"
               data-options="
			panelHeight: 'auto',
		    valueField: 'label',
		    textField: 'value',
		    data: [{
					label: '未审核',
					value: '未审核'
				},{
					label: '审核通过',
					value: '审核通过'
				},{
					label: '下发机台',
					value: '下发机台'
				},{
					label: '生产完成',
					value: '生产完成'
				},{
					label: '提货',
					value: '提货'
				},{
					label: '装车',
					value: '装车'
				},{
					label: '审核失败',
					value: '审核失败'
				}],
		    onSelect: function(rec){
		    	auditQuery(rec.value);
		    }"/>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修改通知单号：&nbsp;
        <input type="text" id="info" style="width: 50px;"/>
        <a href="javascript:updateInfo()" class="easyui-linkbutton" iconCls="icon-ok" plain="true">确定</a>
        <!--<a href="javascript:editSaleListProduct()" class="easyui-linkbutton" iconCls="icon-edit"-->
        <!--plain="true">修改</a>-->
        <form id="updatefm">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数量：<input type="text" id="shuliang" style="width: 50px;">
            <a href="javascript:updateshuliang()"
               class="easyui-linkbutton" iconCls="icon-edit" plain="true">修改数量</a>
            &nbsp;&nbsp;完成数：<input type="text" id="wancheng" style="width: 50px;">
            <a href="javascript:updateWanCheng()"
               class="easyui-linkbutton" iconCls="icon-edit" plain="true">修改完成数</a>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;机台：<input class="easyui-combobox" id="updatejitai" name="jiTai"
                                                                style="width: 100px"
                                                                data-options="panelHeight:'auto',valueField:'id',textField:'name',url:'/admin/jitai/jitaiList'"/>
            <a href="javascript:updatajitai()" class="easyui-linkbutton" iconCls="icon-ok" plain="true">确定</a>
            &nbsp;&nbsp;&nbsp;产品名称：<input type="text" id="chanpingming" name="name" class="easyui-combobox"
                                          style="width: 100px;" url="/admin/product/productList"
                                          data-options="demandd:true,valueField:'name',textField:'name'">
            <a href="javascript:updataname()" class="easyui-linkbutton" iconCls="icon-ok" plain="true">确定</a>
            &nbsp;&nbsp;&nbsp;长度：<input type="text" id="changdu" style="width: 50px;">
            <a href="javascript:updatelength()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">确定</a><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;幅宽：<input type="text" id="fukuan" style="width: 50px;">
            <a href="javascript:updatemodel()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">确定</a>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;厚度：<input type="text" id="houdu" style="width: 50px;">
            <a href="javascript:updateprice()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">确定</a>
            &nbsp;&nbsp;&nbsp;实际厚度：<input type="text" id="shijihoudu" style="width: 50px;">
            <a href="javascript:updatemeter()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">确定</a>
            &nbsp;&nbsp;&nbsp;重量：<input type="text" id="zhongliang" style="width: 50px;">
            <a href="javascript:updateOneweight()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">确定</a>
            &nbsp;&nbsp;&nbsp;农户名：<input type="text" id="nonghu" style="width: 50px;">
            <a href="javascript:updatepeasant()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">确定</a>
            &nbsp;&nbsp;&nbsp;颜色：<input type="text" id="yanse" style="width: 50px;">
            <a href="javascript:updatecolor()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">确定</a>
        </form>
    </div>
</div>

<div id="dlg" class="easyui-dialog" title="审核未通过原因"
     style="padding: 10px 20px" buttons="#dlg-buttons">
    &nbsp;&nbsp;&nbsp;原因：
    <textarea id="cause"
              style="margin-right: 20px; width: 300px; height: 100px; vertical-align: top; resize: none"></textarea>
</div>


<!-- 弹出来的修改框-->
<div id="dialog" class="easyui-dialog"
     style="width: 500px; height: 250px; padding: 10px 20px" title="添加信息" closed="true"
     buttons="#buttons">
    <!-- data-options="onClose:function(){resetValue()}" -->
    <form id="fm" method="post">
        <table>
            <tr>
                <td>产品名称：</td>
                <td>
                    <input type="text" name="name" class="easyui-combobox" style="width: 100px;"
                           url="/admin/product/productList"
                           data-options="demandd:true,valueField:'name',textField:'name'">
                </td>
                <td>长度：</td>
                <td><input type="number" name="length" style="width: 100px;"></td>
            </tr>
            <tr>
                <td>宽度：</td>
                <td><input type="number" name="model" style="width: 100px;"></td>
                <td>重量：</td>
                <td>
                    <input type="number" name="oneweight" style="width: 100px;">
                </td>
            </tr>
            <tr>
                <td>
                    厚度：
                </td>
                <td>
                    <input type="number" name="price" style="width: 100px;">
                </td>
                <td>颜色：</td>
                <td>
                    <input type="text" name="color" style="width: 100px;">
                </td>
            </tr>
            <tr>
                <td>
                    农户名：
                </td>
                <td>
                    <input type="text" name="peasant" style="width: 100px;">
                </td>
                <td>
                    数量：
                </td>
                <td>
                    <input type="number" name="num" style="width: 100px;">
                </td>
            </tr>
            <tr>
                <td>
                    印字：
                </td>
                <td>
                    <input class="easyui-combobox" name="letter" style="width: 100px;" url="/admin/letter/letterList" data-options="valueField:'name',textField:'name'">
                </td>
                <td>
                    剖刀：
                </td>
                <td>
                    <input class="easyui-combobox" name="dao" style="width: 100px;" url="/admin/dao/daoList" data-options="valueField:'name',textField:'name'">
                </td>
            </tr>
            <tr>
                <td>
                    实际厚度：
                </td>
                <td>
                    <input type="number" name="meter" style="width: 100px;">
                </td>
                <td>
                    要求：
                </td>
                <td>
                    <input type="text" name="demand" style="width: 100px;">
                </td>
            </tr>
        </table>
    </form>
</div>

<div id="buttons">
    <a href="javascript:saveGoods()" class="easyui-linkbutton" iconCls="icon-ok">保存</a> <a
        href="javascript:closeDlg('#dialog')" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
</div>

<!-- 审核时的确定关闭按钮 -->
<div id="dlg-buttons">
    <a href="javascript:saveCause()" class="easyui-linkbutton"
       iconCls="icon-ok">确定</a> <a href="javascript:closeCause()"
                                   class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
</div>
</body>
<script>

    //修改订金
    function updatedingjin() {
        var row = $("#dg").datagrid("getSelected");
        if (!row) {
            alert("请选择一行！！");
            return;
        }
        id = row.id;
        if (!$("#dingjin").val()) {
            alert("请输出订金！！");
            return;
        }
        $.ajax({
            type: "POST",
            url: "/admin/saleList/updateDingjin",
            data: {id: id, dingjin: $("#dingjin").val()},
            success: function (result) {
                if (result.success) {
                    alert("修改成功");
                    searchSale();
                    $("#dingjin").val("");
                }
            }
        })
    }
</script>
</html>